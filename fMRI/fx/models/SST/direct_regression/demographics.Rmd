---
title: "demographics"
author: "Ben Smith"
date: "2023-06-13"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,warning = FALSE)

```
This file just generates the stuf that goes into the final paper.
# Prep

```{r}
library(tidyverse)
Sys.setenv(R_CONFIG_ACTIVE = Sys.info()["nodename"])
print(Sys.info()["nodename"])
library(stargazer)
library(tidyverse)
library(gt)
source("preprocessing.R")
source("display_utils.R")

```

```{r}
dropbbox_dir <- config::get("dev_analysis_data_dir")

```


## Demographics

This is designed to read from data generated by `sst_paper_generation.Rmd`.
```{r}



load(paste0(dropbbox_dir,"sst_paper_generation_w12.Rdata"))
load(paste0(dropbbox_dir, "ppt_list_w_data.RData"))

trial_neural_behav_roi_w1 <- trial_neural_behav_roi
```

```{r}

included_subids <- unique(trial_neural_behav_roi_w1$subid)
length(included_subids)

included_ppt_data<-ppt_list_w_data %>% filter(dev_id %in% included_subids)


#@what's in the included neural-behavioral analysis that isn't in ppt_data?
setdiff(ppt_list_w_data$dev_id,included_subids)
setdiff(included_subids,ppt_list_w_data$dev_id)


```


Inclusion criteria were people who were neurotypical, between 18 and 60 years old, interested in eating more healthfully, with no chronic illicit drug use other than marijuana, who had BMIs in the range of 25 to 42.

```{r}
library(lubridate)

year(as.Date(ppt_list_w_data$date_0))#-as.Date(ppt_list_w_data$dob)
ppt_list_w_data$age_in_years <- interval(as.Date(ppt_list_w_data$dob),as.Date(ppt_list_w_data$date_0)) %/% years(1)

bs_table<-table(ppt_list_w_data$birthsex)
num_female<-bs_table[names(bs_table)==1]
num_male<-bs_table[names(bs_table)==2]
```


Mean participant age is `r round(mean(ppt_list_w_data$age_in_years,na.rm=TRUE))` (SD=`r sd(ppt_list_w_data$age_in_years,na.rm=TRUE)`); age range was `r min(ppt_list_w_data$age_in_years,na.rm=TRUE)` to `r max(ppt_list_w_data$age_in_years,na.rm=TRUE)`

There were `r num_female` participants and `r num_male` participants.

## Demographics of Contrast analysis

```{r}
contrast_dataset_raw <- readr::read_csv(paste0(config::get("dev_scripts_path"),"fMRI/fx/models/SST/level2/posterror_cues_no_rt_20230616/raw_filelist.csv"))


contrast_dataset_full <- merge(contrast_dataset_raw,ppt_list_w_data,by.x = "subject_id",by.y="dev_id",all.x=TRUE)


```


```{r}
library(lubridate)

#year(as.Date(ppt_list_w_data$date_0))#-as.Date(ppt_list_w_data$dob)
contrast_dataset_full$age_in_years <- interval(as.Date(contrast_dataset_full$dob),as.Date(contrast_dataset_full$date_0)) %/% years(1)

bs_table<-table(contrast_dataset_full$birthsex)
num_female<-bs_table[names(bs_table)==1]
percent_female <- num_female/nrow(contrast_dataset_full)
num_male<-bs_table[names(bs_table)==2]
percent_male <- num_male/nrow(contrast_dataset_full)
```


Mean participant age is `r round(mean(contrast_dataset_full$age_in_years,na.rm=TRUE))` (SD=`r sd(contrast_dataset_full$age_in_years,na.rm=TRUE)`); age range was `r min(contrast_dataset_full$age_in_years,na.rm=TRUE)` to `r max(contrast_dataset_full$age_in_years,na.rm=TRUE)`

There were `r num_female` female participants and `r num_male` male participants.

## Race

```{r}
race_frequencies<-contrast_dataset_full %>% select(matches("Race ")) %>%
  colSums()

race_proportions <- round(race_frequencies/nrow(contrast_dataset_full),2)
print(race_proportions)

contrast_dataset_full %>% filter(`Race More than One Race`==1) %>%
  select(matches("Race ")) %>% View
  
```

